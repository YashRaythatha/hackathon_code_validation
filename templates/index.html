<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🤖 AI-Powered Hackathon Grader</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #007BFF 0%, #0056b3 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
            max-width: 1400px;
            width: 100%;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            margin-bottom: 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        
        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #007BFF;
        }
        
        .btn {
            background: linear-gradient(135deg, #007BFF 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007BFF;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .results {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }
        
        .error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .success {
            background: #efe;
            border: 1px solid #cfc;
            color: #363;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .agent-selection-header {
            margin-bottom: 20px;
        }
        
        .agent-selection-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .agent-card {
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 12px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .agent-card:hover {
            border-color: #007BFF;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.15);
            transform: translateY(-1px);
        }
        
        .agent-checkbox {
            position: relative;
            display: flex;
            align-items: center;
            margin: 0;
            cursor: pointer;
        }
        
        .agent-checkbox input[type="checkbox"] {
            opacity: 0;
            position: absolute;
            width: 0;
            height: 0;
        }
        
        .checkmark {
            width: 18px;
            height: 18px;
            border: 2px solid #ddd;
            border-radius: 3px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .agent-checkbox input[type="checkbox"]:checked + .checkmark {
            background: #007BFF;
            border-color: #007BFF;
        }
        
        .agent-checkbox input[type="checkbox"]:checked + .checkmark::after {
            content: '✓';
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .agent-content {
            flex: 1;
        }
        
        .agent-content h4 {
            margin: 0 0 4px 0;
            color: #333;
            font-size: 0.9em;
            font-weight: 600;
            line-height: 1.2;
        }
        
        .agent-content p {
            margin: 0;
            color: #666;
            font-size: 0.8em;
            line-height: 1.3;
        }
        
        .agent-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
        
        .action-btn {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #333;
        }
        
        .action-btn:hover {
            background: #e9ecef;
            border-color: #007BFF;
        }
        
        .btn {
            background: linear-gradient(135deg, #007BFF 0%, #0056b3 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.4);
        }
        
        .results-section {
            margin-top: 30px;
            display: none;
        }
        
        .overall-score-card {
            background: linear-gradient(135deg, #007BFF 0%, #0056b3 100%);
            color: white;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 123, 255, 0.3);
        }
        
        .overall-score-card h2 {
            margin: 0 0 10px 0;
            font-size: 1.5em;
            font-weight: 600;
        }
        
        .overall-score {
            font-size: 3em;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .score-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 1.1em;
            font-weight: 500;
        }
        
        .score-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .score-card {
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .score-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .score-card-icon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .score-card-title {
            font-weight: 600;
            color: #333;
        }
        
        .score-value {
            font-size: 1.5em;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .score-description {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        
        .ai-confidence {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .confidence-bar {
            flex: 1;
            height: 6px;
            background: #e1e5e9;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #007BFF 0%, #0056b3 100%);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .confidence-text {
            font-size: 0.9em;
            color: #666;
            min-width: 60px;
        }
        
        @media (max-width: 1200px) {
            .agent-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            .agent-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .agent-actions {
                flex-direction: column;
            }
            .score-cards {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .agent-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* New Analysis Display Styles */
        .analysis-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #007BFF;
        }
        
        .analysis-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f8f9fa;
        }
        
        .analysis-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 15px;
        }
        
        .analysis-title {
            flex: 1;
        }
        
        .analysis-title h3 {
            margin: 0 0 5px 0;
            color: #333;
            font-size: 1.3em;
        }
        
        .analysis-score {
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .confidence-indicator {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .confidence-indicator .confidence-bar {
            width: 120px;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .confidence-indicator .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc3545 0%, #ffc107 50%, #28a745 100%);
            transition: width 0.3s ease;
        }
        
        .confidence-indicator span {
            font-size: 0.85em;
            color: #666;
        }
        
        .analysis-content {
            display: grid;
            gap: 20px;
        }
        
        .analysis-section-content {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }
        
        .analysis-section-content h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .insights-list, .evidence-list, .recommendations-list, .risks-list {
            margin: 0;
            padding-left: 20px;
        }
        
        .insights-list li, .evidence-list li, .recommendations-list li, .risks-list li {
            margin-bottom: 4px;
            line-height: 1.3;
            color: #555;
        }
        
        .insights-list li {
            color: #2c5aa0;
        }
        
        .recommendations-list li {
            color: #28a745;
        }
        
        .risks-list li {
            color: #dc3545;
        }
        
        .overall-summary {
            background: linear-gradient(135deg, #007BFF 0%, #0056b3 100%);
            color: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .overall-summary h3 {
            margin: 0 0 20px 0;
            font-size: 1.4em;
        }
        
        .summary-content {
            display: grid;
            gap: 15px;
        }
        
        .summary-section {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
        }
        
        .summary-section h4 {
            margin: 0 0 10px 0;
            font-size: 1.1em;
        }
        
        .summary-section ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .summary-section li {
            margin-bottom: 3px;
            line-height: 1.3;
        }

        /* Human-friendly insight styles */
        .insights-content {
            display: grid;
            gap: 10px;
        }

        .insight-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            border-left: 4px solid #007BFF;
        }

        .insight-section h5 {
            margin: 0 0 6px 0;
            color: #333;
            font-size: 1.1em;
            font-weight: 600;
        }

        .insight-content {
            color: #555;
            line-height: 1.3;
            white-space: pre-line;
        }

        .insight-item {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 4px;
            color: #555;
            line-height: 1.3;
        }
        
        
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 AI-Powered Hackathon Grader</h1>
            <p>Analyze any GitHub repository with advanced AI agents</p>
            <a href="/judge-config" style="color: #007BFF; text-decoration: none; margin-top: 10px; display: inline-block;">⚙️ Configure Judging Weights</a>
        </div>
        
        <form id="analysisForm">
            <div class="form-row">
                <div class="form-group">
                    <label for="repoUrl">GitHub Repository URL:</label>
                    <input type="url" id="repoUrl" name="repoUrl" placeholder="https://github.com/username/repository" required>
                </div>
                
                <div class="form-group">
                    <label for="branch">Branch (optional):</label>
                    <input type="text" id="branch" name="branch" placeholder="main" value="main">
                </div>
            </div>
            
            <div class="form-group">
                <div class="agent-selection-header">
                    <h3>🎯 Select AI Agents to Run</h3>
                    <p style="color: #666; font-size: 0.9em; margin-top: 5px;">Choose any combination of agents for comprehensive analysis</p>
                </div>
                <div class="agent-grid">
                    <div class="agent-card" onclick="this.querySelector('input[type=checkbox]').click()">
                        <label class="agent-checkbox">
                            <input type="checkbox" name="agents" value="1">
                            <span class="checkmark"></span>
                        </label>
                        <div class="agent-content">
                            <h4>Code Analysis</h4>
                            <p>Analyzes code quality, patterns, and best practices</p>
                        </div>
                    </div>
                    
                    <div class="agent-card" onclick="this.querySelector('input[type=checkbox]').click()">
                        <label class="agent-checkbox">
                            <input type="checkbox" name="agents" value="2">
                            <span class="checkmark"></span>
                        </label>
                        <div class="agent-content">
                            <h4>Architecture Analysis</h4>
                            <p>Evaluates design patterns and system structure</p>
                        </div>
                    </div>
                    
                    <div class="agent-card" onclick="this.querySelector('input[type=checkbox]').click()">
                        <label class="agent-checkbox">
                            <input type="checkbox" name="agents" value="3">
                            <span class="checkmark"></span>
                        </label>
                        <div class="agent-content">
                            <h4>UI/UX Analysis</h4>
                            <p>Assesses interface quality and user experience</p>
                        </div>
                    </div>
                    
                    <div class="agent-card" onclick="this.querySelector('input[type=checkbox]').click()">
                        <label class="agent-checkbox">
                            <input type="checkbox" name="agents" value="4">
                            <span class="checkmark"></span>
                        </label>
                        <div class="agent-content">
                            <h4>Security Analysis</h4>
                            <p>Checks security practices and compliance</p>
                        </div>
                    </div>
                    
                    <div class="agent-card" onclick="this.querySelector('input[type=checkbox]').click()">
                        <label class="agent-checkbox">
                            <input type="checkbox" name="agents" value="5">
                            <span class="checkmark"></span>
                        </label>
                        <div class="agent-content">
                            <h4>Innovation & Creativity</h4>
                            <p>Evaluates novelty and creative use of technology</p>
                        </div>
                    </div>
                    
                    <div class="agent-card" onclick="this.querySelector('input[type=checkbox]').click()">
                        <label class="agent-checkbox">
                            <input type="checkbox" name="agents" value="6">
                            <span class="checkmark"></span>
                        </label>
                        <div class="agent-content">
                            <h4>Functionality & Completeness</h4>
                            <p>Assesses working features and completeness</p>
                        </div>
                    </div>
                    
                    <div class="agent-card" onclick="this.querySelector('input[type=checkbox]').click()">
                        <label class="agent-checkbox">
                            <input type="checkbox" name="agents" value="7">
                            <span class="checkmark"></span>
                        </label>
                        <div class="agent-content">
                            <h4>Technical Complexity</h4>
                            <p>Analyzes technical difficulty and architecture</p>
                        </div>
                    </div>
                    
                    <div class="agent-card" onclick="this.querySelector('input[type=checkbox]').click()">
                        <label class="agent-checkbox">
                            <input type="checkbox" name="agents" value="8">
                            <span class="checkmark"></span>
                        </label>
                        <div class="agent-content">
                            <h4>UI/UX Polish</h4>
                            <p>Evaluates visual design and user experience</p>
                        </div>
                    </div>
                    
                    <div class="agent-card" onclick="this.querySelector('input[type=checkbox]').click()">
                        <label class="agent-checkbox">
                            <input type="checkbox" name="agents" value="9">
                            <span class="checkmark"></span>
                        </label>
                        <div class="agent-content">
                            <h4>Learning Agent</h4>
                            <p>Applies patterns from past analyses</p>
                        </div>
                    </div>
                </div>
                
                <div class="agent-actions">
                    <button type="button" class="action-btn" onclick="selectAllAgents()">Select All</button>
                    <button type="button" class="action-btn" onclick="selectDefaultAgents()">Default</button>
                    <button type="button" class="action-btn" onclick="clearAllAgents()">Clear All</button>
                </div>
            </div>
            
            <button type="submit" class="btn" id="analyzeBtn">
                🚀 Analyze Repository
            </button>
        </form>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>AI agents are analyzing your repository...</p>
        </div>
        
        <div class="error" id="error"></div>
        <div class="success" id="success"></div>
        
        <div id="results" class="results-section">
            <div class="overall-score-card">
                <h2>Overall Score</h2>
                <div class="overall-score" id="overallScore">6.0/10</div>
                <div class="score-status" id="scoreStatus">
                    <span>--</span>
                </div>
            </div>
            
            <div class="score-cards" id="scoreCards">
                <!-- Score cards will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Agent selection functions
        function selectAllAgents() {
            const checkboxes = document.querySelectorAll('input[name="agents"]');
            checkboxes.forEach(checkbox => checkbox.checked = true);
        }
        
        function selectDefaultAgents() {
            const checkboxes = document.querySelectorAll('input[name="agents"]');
            checkboxes.forEach(checkbox => checkbox.checked = false);
            // No default agents selected - user must choose
        }
        
        function clearAllAgents() {
            const checkboxes = document.querySelectorAll('input[name="agents"]');
            checkboxes.forEach(checkbox => checkbox.checked = false);
        }
        
        function displayResults(data) {
            console.log('displayResults called with data:', data);
            const results = document.getElementById('results');
            const overallScore = document.getElementById('overallScore');
            const scoreCards = document.getElementById('scoreCards');
            
            // Update overall score
            console.log('Updating overall score to:', data.total_score);
            overallScore.textContent = `${data.total_score}/10`;
            
            // Update score status
            const scoreStatus = document.getElementById('scoreStatus');
            const score = data.total_score || 0;
            if (score >= 9) {
                scoreStatus.innerHTML = '<span style="color: #28a745;">★ EXCELLENT</span>';
            } else if (score >= 7) {
                scoreStatus.innerHTML = '<span style="color: #17a2b8;">✓ GOOD</span>';
            } else if (score >= 5) {
                scoreStatus.innerHTML = '<span style="color: #ffc107;">⚠ FAIR</span>';
            } else {
                scoreStatus.innerHTML = '<span style="color: #dc3545;">✗ NEEDS IMPROVEMENT</span>';
            }
            
            // Create comprehensive analysis display
            let analysisHTML = '';
            
            if (data.breakdown) {
                Object.entries(data.breakdown).forEach(([category, details]) => {
                    const score = details.score || 0;
                    const confidence = Math.round((details.ai_confidence || 0) * 100);
                    const icon = getCategoryIcon(category);
                    const color = getScoreColor(score);
                    
                    // Get detailed analysis data
                    const evidence = details.evidence || [];
                    const recommendations = details.recommendations || [];
                    const insights = details.insights || [];
                    const risks = details.risks || [];
                    
                    analysisHTML += `
                        <div class="analysis-section">
                            <div class="analysis-header">
                                <div class="analysis-icon" style="background: ${icon.color}">${icon.symbol}</div>
                                <div class="analysis-title">
                                    <h3>${category.charAt(0).toUpperCase() + category.slice(1)} Analysis</h3>
                                    <div class="analysis-score" style="color: ${color}">${score}/10</div>
                                </div>
                                <div class="confidence-indicator">
                                    <div class="confidence-bar">
                                        <div class="confidence-fill" style="width: ${confidence}%"></div>
                                    </div>
                                    <span>AI Confidence: ${confidence}%</span>
                                </div>
                            </div>
                            
                            <div class="analysis-content">
                                ${insights.length > 0 ? `
                                    <div class="analysis-section-content">
                                        <h4>🔍 Analysis Details</h4>
                                        <div class="insights-content">
                                            ${insights.map(insight => {
                                                // Parse human-friendly format
                                                if (insight.includes('🎯 Why this score is high:')) {
                                                    return `<div class="insight-section">
                                                        <h5>🎯 Why this score is high:</h5>
                                                        <div class="insight-content">${insight.split('🎯 Why this score is high:')[1].split('⚠️ Why some points were deducted:')[0].trim()}</div>
                                                    </div>`;
                                                } else if (insight.includes('⚠️ Why some points were deducted:')) {
                                                    return `<div class="insight-section">
                                                        <h5>⚠️ Why some points were deducted:</h5>
                                                        <div class="insight-content">${insight.split('⚠️ Why some points were deducted:')[1].split('📊 Key Reasons for the Score:')[0].trim()}</div>
                                                    </div>`;
                                                } else if (insight.includes('📊 Key Reasons for the Score:')) {
                                                    return `<div class="insight-section">
                                                        <h5>📊 Key Reasons for the Score:</h5>
                                                        <div class="insight-content">${insight.split('📊 Key Reasons for the Score:')[1].split('💡 In Simple Terms:')[0].trim()}</div>
                                                    </div>`;
                                                } else if (insight.includes('💡 In Simple Terms:')) {
                                                    return `<div class="insight-section">
                                                        <h5>💡 In Simple Terms:</h5>
                                                        <div class="insight-content">${insight.split('💡 In Simple Terms:')[1].trim()}</div>
                                                    </div>`;
                                                } else {
                                                    // Fallback for simple insights
                                                    return `<div class="insight-item">${insight}</div>`;
                                                }
                                            }).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                ${evidence.length > 0 ? `
                                    <div class="analysis-section-content">
                                        <h4>📊 Evidence Found</h4>
                                        <ul class="evidence-list">
                                            ${evidence.map(item => `<li>${item}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                                
                                ${recommendations.length > 0 ? `
                                    <div class="analysis-section-content">
                                        <h4>💡 Recommendations</h4>
                                        <ul class="recommendations-list">
                                            ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                                
                                ${risks.length > 0 ? `
                                    <div class="analysis-section-content">
                                        <h4>⚠️ Potential Risks</h4>
                                        <ul class="risks-list">
                                            ${risks.map(risk => `<li>${risk}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });
            }
            
            // Add overall summary if available
            if (data.evidence && data.evidence.length > 0) {
                analysisHTML = `
                    <div class="overall-summary">
                        <h3>📋 Overall Analysis Summary</h3>
                        <div class="summary-content">
                            <div class="summary-section">
                                <h4>Evidence Found</h4>
                                <ul>${data.evidence.map(item => `<li>${item}</li>`).join('')}</ul>
                            </div>
                            ${data.recommendations && data.recommendations.length > 0 ? `
                                <div class="summary-section">
                                    <h4>Key Recommendations</h4>
                                    <ul>${data.recommendations.map(rec => `<li>${rec}</li>`).join('')}</ul>
                                </div>
                            ` : ''}
                            ${data.insights && data.insights.length > 0 ? `
                                <div class="summary-section">
                                    <h4>Key Insights</h4>
                                    <ul>${data.insights.map(insight => `<li>${insight}</li>`).join('')}</ul>
                                </div>
                            ` : ''}
                            ${data.risks && data.risks.length > 0 ? `
                                <div class="summary-section">
                                    <h4>Potential Risks</h4>
                                    <ul>${data.risks.map(risk => `<li>${risk}</li>`).join('')}</ul>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                ` + analysisHTML;
            }
            
            
            scoreCards.innerHTML = analysisHTML;
            results.style.display = 'block';
        }
        
        function getCategoryIcon(category) {
            const icons = {
                'architecture': { symbol: '🏛️', color: '#8B4513' },
                'coding': { symbol: '💻', color: '#1E90FF' },
                'compliance': { symbol: '📋', color: '#8B4513' },
                'ui': { symbol: '🎨', color: '#FF6B6B' },
                'security': { symbol: '🔒', color: '#32CD32' },
                'innovation': { symbol: '💡', color: '#FFD700' },
                'functionality': { symbol: '⚙️', color: '#9370DB' },
                'technical': { symbol: '🔧', color: '#FF8C00' },
                'learning': { symbol: '🧠', color: '#20B2AA' }
            };
            return icons[category] || { symbol: '📊', color: '#666' };
        }
        
        function getScoreColor(score) {
            if (score >= 8) return '#28a745';
            if (score >= 6) return '#ffc107';
            if (score >= 4) return '#fd7e14';
            return '#dc3545';
        }
        
        function getCategoryDescription(category) {
            const descriptions = {
                'architecture': 'Code structure, design patterns, and system organization',
                'coding': 'Code quality, best practices, and implementation',
                'compliance': 'Security, documentation, and project standards',
                'ui': 'User interface design, user experience, and visual appeal',
                'security': 'Security practices, vulnerability assessment, and compliance',
                'innovation': 'Novelty, creativity, and innovative use of technology',
                'functionality': 'Working features, completeness, and functionality',
                'technical': 'Technical complexity, architecture, and implementation',
                'learning': 'Learning patterns, adaptability, and improvement'
            };
            return descriptions[category] || 'Analysis category';
        }
        
        document.getElementById('analysisForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const form = e.target;
            const repoUrl = form.repoUrl.value;
            const branch = form.branch.value || 'main';
            
            // Get selected agents
            const selectedAgents = Array.from(form.querySelectorAll('input[name="agents"]:checked'))
                .map(checkbox => checkbox.value);
            
            if (selectedAgents.length === 0) {
                document.getElementById('error').textContent = 'Please select at least one agent.';
                document.getElementById('error').style.display = 'block';
                return;
            }
            
            const analyzeBtn = document.getElementById('analyzeBtn');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const success = document.getElementById('success');
            const results = document.getElementById('results');
            
            // Reset UI
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = '🔄 Analyzing...';
            loading.style.display = 'block';
            error.style.display = 'none';
            success.style.display = 'none';
            results.style.display = 'none';
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        repo_url: repoUrl,
                        branch: branch,
                        selected_agents: selectedAgents
                    })
                });
                
                const data = await response.json();
                
                console.log('Response data:', data);
                if (!data.success || data.error) {
                    error.textContent = data.error || 'Analysis failed. Please try again.';
                    error.style.display = 'block';
                } else {
                    const results = data.results;
                    console.log('Results data:', results);
                    success.textContent = `✅ Analysis complete! Score: ${results.total_score}/10`;
                    success.style.display = 'block';
                    
                    // Display results in card format
                    displayResults(results);
                }
            } catch (err) {
                error.textContent = 'Failed to analyze repository. Please try again.';
                error.style.display = 'block';
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = '🚀 Analyze Repository';
                loading.style.display = 'none';
            }
        });
    </script>
</body>
</html>
